<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="robots" content="noindex, nofollow">
<meta name="googlebot" content="noindex, nofollow">
  <title>Modo AFK - Combate</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="maintenance.js"></script>
  <script src="monster_stages.js"></script> 
  <script type="module" defer src="afk_page.js"></script>
  <script>
   // Registro do Service Worker Otimizado
if ('serviceWorker' in navigator) {
    const registerSW = () => {
        navigator.serviceWorker.register('/sw.js')
            .then(reg => {
                // Verifica se h√° atualiza√ß√µes a cada 1 hora se o app ficar aberto
                setInterval(() => reg.update(), 60 * 60 * 1000); 
                
                if (reg.installing) {
                    console.log('‚öôÔ∏è SW: Instalando...');
                } else if (reg.waiting) {
                    console.log('‚öôÔ∏è SW: Aguardando ativa√ß√£o...');
                } else if (reg.active) {
                    console.log('‚úÖ SW: Ativo e servindo cache!');
                }
            })
            .catch(err => console.error('‚ùå Erro ao registrar SW:', err));
    };
  </script>
  <style>

/* Bal√£o de Level Up */
.level-up-balloon {
  position: fixed;
  top: 20%;
  left: 50%;
  transform: translateX(-50%);
  background: #ffd700;
  color: #000;
  padding: 12px 24px;
  border-radius: 12px;
  font-size: 20px;
  font-weight: bold;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
  width: 80%;
  z-index: 9999;
        background-image: url('https://aden-rpg.pages.dev/assets/aventura.webp'); 
        background-repeat: no-repeat;
        background-position: center center; 
        background-size: contain; 
        display: flex; 
        flex-direction: column;
        align-items: center;
        justify-content: center;
      border: none; /* Remove a borda */
  box-shadow: none; /* Remove a sombra */
  outline: none;
        box-sizing: border-box; 
        background-color: transparent; 
        max-width: none; 
        margin: 0; 
  
  animation: fadeInOut 6s ease-in-out forwards;
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -20px); }
  10% { opacity: 1; transform: translate(-50%, 0); }
  90% { opacity: 1; transform: translate(-50%, 0); }
  100% { opacity: 0; transform: translate(-50%, -20px); }
}





#tutorial-modal .modal-content::-webkit-scrollbar {
        width: 0;  
        background: transparent;
    }
     #tutorial-modal .modal-content {
    scrollbar-width: none;  
    -ms-overflow-style: none;
}
    

    /* Seus estilos CSS existentes aqui (mantidos do seu arquivo style.css) */
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      /* Remova padding e ajuste display para permitir que #idle-screen ocupe tudo */
      padding: 0; 
      display: flex; /* Mant√©m a estrutura flex, mas ser√° sobreposta por #idle-screen */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      max-height: 100vh;
      max-width: 100vw;
      margin: 0; /* Garante que n√£o h√° margens no body */
      overflow-x: hidden; /* Evita rolagem horizontal indesejada */
    }

    .afk-container, #combat-screen {
      /* Estas divs internas n√£o devem ter backgrounds ou margens que conflitem com o background de tela cheia */
      max-width: 400px;
      width: 100%;
      margin: 20px auto; /* Mantenha margem auto para centralizar o conte√∫do, se desejar */
      background-color: transparent; /* Torna o fundo transparente */
      padding: 20px;
      border-radius: 8px;
      box-shadow: none; /* Remove a sombra, pois a imagem √© o background */
      box-sizing: border-box; /* Garante que padding n√£o aumente o tamanho total */
    }
#afk-status p {
font-size: 18px;
color: white;
font-weight: bold;
text-shadow: 2px 2px 2px black;
background-color: rgba(0, 0, 0, 0.4);
box-shadow: 7px 1px 10px rgba(0,0,0,0.2); 
border-radius: 12px;
}
#start-afk-cooldown-display {
font-weight: bold;
font-size: 18px; 
}
#afk-stage, #player-total-xp, #player-total-gold, #afk-xp, #afk-gold, #afk-timer, #daily-attempts-left {
color: yellow;
}
    h1, h2, p {
      margin: 10px 0;
    }
  

    .btn {
      background-color: none;
      color: white;
      padding: 5px 47px;
      
      cursor: pointer;
      font-size: 1em;
      margin: 3px;
      text-decoration: none; /* Para bot√µes que s√£o links */
      display: inline-block;
    }

    .btn:hover:not(:disabled) {
      background-color: none;
    
    }

    .btn:disabled {
      color: white;
      font-size: 12px;
      background-color: none;
      cursor: not-allowed;
      padding: 5px 47px;
      opacity: 0.6;
      
    }

    /* Estilos da barra de HP do monstro */
    #monster-hp-bar {
      position: relative; /* Adicionado para posicionar o texto de HP sobre ele */
      width: 80%;
      height: 25px;
      background: #333;
      border: 1px solid #444;
      border-radius: 5px;
      overflow: hidden;
      margin: 15px auto;
    }

    #monster-hp-fill {
      height: 100%;
      background-color: #dc3545; /* Cor vermelha para HP */
      width: 100%; /* Come√ßa cheio */
      transition: width 0.3s ease-out;
    }

    #monsterImage {
    display: block;
    width: 180px;
    height: 380px;
    margin: 0 auto 10px auto;
    object-fit: contain;
    filter: none;
    /* Anima√ß√£o de flutua√ß√£o */
    animation: float 3s ease-in-out infinite;
}

/* Keyframes para a anima√ß√£o de flutua√ß√£o */
@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-20px); } /* ALTERADO: 8px para cima e para baixo */
    100% { transform: translateY(0px); }
}

/* Anima√ß√£o de Tremida (Shake) */
@keyframes shake {
  0% { transform: translate(1px, 1px) rotate(0deg); }
  10% { transform: translate(-1px, -2px) rotate(-1deg); }
  20% { transform: translate(-3px, 0px) rotate(1deg); }
  30% { transform: translate(3px, 2px) rotate(0deg); }
  40% { transform: translate(1px, -1px) rotate(1deg); }
  50% { transform: translate(-1px, 2px) rotate(-1deg); }
  60% { transform: translate(-3px, 1px) rotate(0deg); }
  70% { transform: translate(3px, 1px) rotate(-1deg); }
  80% { transform: translate(-1px, -1px) rotate(1deg); }
  90% { transform: translate(1px, 2px) rotate(0deg); }
  100% { transform: translate(1px, -2px) rotate(-1deg); }
}

.shake-animation {
  /* !important garante que sobrescreva a anima√ß√£o de flutuar (float) durante o dano */
  animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both !important; 
  backface-visibility: hidden;
  perspective: 1000px;
}

    /* Modal de Resultados */
    #result-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #333;
      color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
      z-index: 1000;
      text-align: center;
      min-width: 280px;
    }
    #result-modal p {
      font-size: 1.2em;
      margin-bottom: 20px;
      color: white;
    }
    #result-modal button {
      padding: 12px 25px;
      font-size: 1.1em;
      background-color: #28a745;
    }
    #result-modal button:hover {
      background-color: #218838;
    }

    /* Estilos para as telas */
    #idle-screen, #combat-screen {
        display: flex; /* Garante que os itens fiquem em coluna */
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        gap: 0.75rem;
    }


/* Estilos b√°sicos para os n√∫meros de dano flutuantes */
.normal-damage-number, .crit-damage-number {
    position: absolute;
    font-family: 'Georgia', serif; /* Exemplo de fonte 'em flor' */
    font-weight: bold;
    pointer-events: none; /* Ignora eventos de clique no n√∫mero */
    white-space: nowrap; /* Impede que o texto quebre linha */
    text-align: center;
    z-index: 10; /* Garante que o dano apare√ßa acima de outros elementos */
}

.normal-damage-number {
    font-size: 40px;
    color: white;
    /* Contorno preto */
    text-shadow:
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
}

.crit-damage-number {
    font-size: 57px;
    color: red;
    /* Contorno amarelo */
    text-shadow:
        -1px -1px 0 yellow,
        1px -1px 0 yellow,
        -1px 1px 0 yellow,
        1px 1px 0 yellow,
        -2px -2px 0 yellow,
        2px -2px 0 yellow,
        -2px 2px 0 yellow,
        2px 2px 0 yellow; /* Para um contorno mais pronunciado */
}

/* Anima√ß√£o para flutuar e desaparecer */
@keyframes floatAndFade {
    0% {
        opacity: 1;
        transform: translate(-50%, 0); /* Come√ßa centralizado, sem movimento vertical */
    }
    100% {
        opacity: 0;
        transform: translate(-50%, -50px); /* Move para cima 50px e some */
    }
}

/* NOVOS ESTILOS PARA O TEXTO DE HP NA BARRA */
#monster-hp-text-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%); /* Centraliza o texto */
  color: white; /* Cor do texto em branco */
  font-weight: bold; /* Deixa o texto em negrito */
  z-index: 1; /* Garante que o texto fique acima da barra de preenchimento */
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); /* Sombra para melhor legibilidade */
  pointer-events: none; /* Permite cliques atrav√©s do texto para elementos abaixo, se houver */
}

    /* ESTILOS PARA #idle-screen COM BACKGROUND DE TELA CHEIA */
    #idle-screen {
        width: 100vw;
        height: 100vh; 
        max-height: 100vh;
        background-image: url('https://aden-rpg.pages.dev/assets/divperga.webp'); 
        background-repeat: no-repeat;
        background-position: center center; 
        background-size: cover; 
        display: flex; 
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px; 
        box-sizing: border-box; 
        background-color: transparent; 
        max-width: none; 
        margin: 0; 
        box-shadow: none; 
        border-radius: 0; 
    }
    #combat-screen {
        width: 100vw;
        min-height: 100vh;
        
        background-image: url('https://aden-rpg.pages.dev/assets/amasmorra.webp'); /* Nova imagem da masmorra */
        background-repeat: no-repeat;
        background-position: center center;
        background-size: cover;
        
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;

        background-color: transparent; 
        max-width: none;
        margin: 0;
        box-shadow: none;
        border-radius: 0;
        position: relative; 
        z-index: 1; 
    }
    p {
      font-weight: bold;
    }
    #saiba-mais {
      color: white;
      font-weight: bold;
    }
    
    @keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
    100% { transform: translateY(0px); }
}

#result-modal, .modal, #music-permission-modal {
background-image: url('https://aden-rpg.pages.dev/assets/divperga.webp'); 
        background-repeat: no-repeat;
        background-position: center center; 
        background-size: cover; 
      font-weight: bold;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      color: #white!important;
        box-sizing: border-box; 
        background-color: transparent; 
        max-width: none; 
        margin: 0; 
        border: none;
        box-shadow: none;
        text-shadow: 2px 2px 2px black;
        }
       
        #levelUpBalloon {
        flex-direction: column;
        align-items: center;
        justify-content: center;
        }
        
  </style>
</head>
<body>

  <div id="idle-screen">
    <h1>Aventura AFK</h1>
 <p style="text-shadow: 2px 2px 2px black;">Voc√™ continua coletando recursos mesmo offline.<br>
 <span id="saiba-mais">  <img src="https://aden-rpg.pages.dev/assets/tutorialbtn.webp" style="width:30px; height:30px; vertical-align: 5px; right: 3px;"> </span></p>
 <div id="tutorial-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>Coletando</h2>
      <p style="text-align: justify;">Voc√™ coleta XP (garantido) e Ouro (se houver evento em andamento) mesmo estando offline com um limite de 4 horas.<br> Ap√≥s essas 4 horas, a coleta √© interrompida at√© voc√™ coletar as recompensas.<br> O tempo m√≠nimo para coletar √© de 1 hora, ou seja, voc√™ s√≥ pode fazer uma coleta ap√≥s ter passado pelo menos 1 hora.</p> <br>
<h1>Combate</h1>
<p style="text-align: justify;">Ao iniciar aventura, o modo combate √© ativado e um monstro aleat√≥rio aparecer√° para voc√™ desafiar.<br> Neste modo de Aventura AFK o monstro n√£o ataca. A batalha ocorre automaticamente e seu personagem desfere 10 golpes.<br> Se nesses 10 golpes voc√™ conseguir  eliminar o  monstro, ent√£o ser√° vit√≥ria, e voc√™ ganhar√° XP (garantido) e Ouro (se houver evento em andamento) como recompensa de est√°gio e, consequentemente, aumentar√° a coleta no modo afk.<br>
Se voc√™ n√£o conseguir avan√ßar de est√°gio, poder√° "farmar" (coletar) as recompensas do andar anterior sem a necessidade de batalhar.<br>
Voc√™ tem 5 tentativas di√°rias para iniciar aventura, que s√£o resetadas √†s 21h (de Bras√≠lia).</p>
      <button id="close-tutorial-btn" class="btn">Entendi!</button>
    </div>
  </div>

    <div id="afk-status">
      <p>Est√°gio Atual: <span id="afk-stage">--</span></p>
      <p style="display: none">XP Total: <span id="player-total-xp">0</span></p>
      <p style="display: none">Ouro Total: <span id="player-total-gold">0</span></p>
      
      <p><img src="https://aden-rpg.pages.dev/assets/exp.webp" style="width: 40px; height: 35px; vertical-align: -12px;"> <span id="afk-xp">0</span></p>
      <p style="display:none;"><img src="https://aden-rpg.pages.dev/assets/goldcoin.webp" style="width: 40px; height: 35px; vertical-align: -10px;"> <span id="afk-gold">0</span> <span style="font-size: 0.7em;; vertical-align: 7px;">(evento)</span></p>
      <p><video width="30" height="30" autoplay loop muted playsinline style="border-radius: 58%; vertical-align: -8px;">
  <source src="https://aden-rpg.pages.dev/assets/ampulheta.webm" type="video/webm">
  Seu navegador n√£o suporta o formato de v√≠deo WebM.
</video> <span id="afk-timer">04:00:00</span></p>
      <p>Tentativas Di√°rias Restantes: <span id="daily-attempts-left">--</span></p>
    </div>

    <div id="afk-buttons">
      <button id="collect-rewards-idle" class="btn">Coletar Recompensas</button>
      <button id="start-afk" class="btn">Iniciar Aventura</button>
      <button id="watch-ad-attempt-btn" class="btn" style="display: none; font-size: 1em; font-weight: bold;">Assistir +1</button>
      <a id="trigger-afk_attempt-ad" href="go:anaf" style="display:none;"></a>
      <a href="#" id="menuToggleBtn" class="btn">Voltar</a>
    </div>
  </div>

  <div id="combat-screen" style="display:none; position: relative;">
    <h1>Combate</h1>

    <div id="battle-countdown" style="display:none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5em; font-weight: bold; color: white; text-shadow: 2px 2px 4px black; z-index: 10;"></div>

    <div id="afk-status">
      <p><strong>Desafiando</strong> <span id="monster-name">---</span></p>
      <img id="monsterImage" src="" alt="Monstro" />
      <div id="monster-hp-bar">
        <div id="monster-hp-fill"></div>
        <span id="monster-hp-text-overlay"> <span id="monster-hp-value"></span></span>
      </div>
      <p><strong></strong> <span id="dps"></span></p>
      <p><strong>Ataques restantes:</strong> <span id="time-left">0</span></p>
    </div>

    <div id="afk-buttons">
     
    </div>
  </div>

  <div id="result-modal">
    <p id="result-text"></p>
    <button id="confirm-btn" class="btn">Confirmar</button>
  </div>
  <div id="adventure-options-modal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 400px;">
    <h2>Escolha sua Batalha</h2>
    <p>Use uma tentativa di√°ria para:</p>
    
    <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
      <button id="btn-farm-previous" class="btn" style="font-size: 1.2em;">
        Farmar Est√°gio <span id="farm-stage-number">--</span>
      </button>

      <button id="btn-challenge-current" class="btn" style="font-size: 1.2em;">
        Desafiar Est√°gio <span id="challenge-stage-number">--</span> 
      </button>
    </div>

    <button id="close-adventure-options" class="btn" style="margin-top: 20px; background: transparent; border: 1px solid #555;">Cancelar</button>
  </div>
</div>


<div id="levelUpModal" class="modal" style="display:none;">
  <div class="modal-content">
    <h2>üéâ N√≠vel Up!</h2>
    <p id="levelUpMessage"></p>
    <button onclick="closeLevelUpModal()">Confirmar</button>
  </div>
</div>


<div id="levelUpBalloon" class="level-up-balloon" style="display:none;"><br>
  <h1>N√≠vel</h1><h1 id="levelUpBalloonText"></h1><span stylr="color: white!important; font-weight: bold;"></span>
</div>

<div id="music-permission-modal" class="modal" style="display: flex;">
  
  <div class="modal">
   <h1>Ajude-nos!</h1>
    <p>Monstros est√£o invadindo o <br>continente de Aden! <br>Ajude a derrot√°-los!</p>
    <button id="music-permission-btn" class="btn">ENTRAR!</button>
  </div>
</div>


<div id="maintenance-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); color: white; z-index: 9999; justify-content: center; align-items: center; text-align: center; flex-direction: column; font-family: Arial, sans-serif;">
    <img src="https://aden-rpg.pages.dev/assets/config.webp" alt="Manuten√ß√£o" style="width: 120px; height: 120px; margin-bottom: 20px;">
    <h1 id="maintenance-title">Aviso de Manuten√ß√£o</h1>
    <p id="maintenance-message" style="font-size: 1.2em; max-width: 80%;"></p>
    <p style="font-size: 0.9em; margin-top: 20px;">Obrigado pela sua paci√™ncia.</p>
</div>
<div id="countdown-banner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; padding: 10px; background-color: rgba(0, 0, 0, 0.9); color: white; text-align: center; z-index: 9999; font-family: Arial, sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.3); font-weight: bold;">
    <div style="font-size: 1.5em; font-weight: bold;">
        <span id="countdown-timer"></span>
    </div>
    <div style="font-size: 0.9em; margin-top: 5px;">
        O servidor entrar√° em manuten√ß√£o dentro de instantes. Por favor, n√£o inicie alguma opera√ß√£o no jogo para n√£o ter risco de perda de dados. Obrigado pela paci√™ncia!
    </div>
</div>
<script src="loading.js"></script>
<div id="google_translate_element"></div>

<script src="auto_translate.js"></script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script>
(function() {
    const MUSIC_MUTE_KEY = 'backgroundMusicMuted';
    const isGloballyMuted = localStorage.getItem(MUSIC_MUTE_KEY) === 'true';

    // Lista de URLs de M√öSICA DE FUNDO (BGM)
    // Se o URL do √°udio criado contiver qualquer uma dessas strings, ele ser√° mutado.
    const BGM_URL_FRAGMENTS = [
        '/assets/music_loop_02.mp3', // √çndice principal
        '/assets/idlesong.mp3',      // afk_page.js
        '/assets/combat_afk_bg.mp3', // afk_page.js
        '/assets/mina.mp3',
        '/assets/desolation_tower.mp3',
        '/assets/arena.mp3',
        // mines.js
        // ADICIONE AQUI FRAGMENTOS DE URL DE QUALQUER OUTRA M√öSICA DE FUNDO
        // Ex: '/assets/arena_bgm.mp3', '/assets/raid_bgm.mp3'
    ];

    // Guarda o construtor original
    const OriginalAudio = window.Audio;

    // Se o mute n√£o estiver ativo, ou se j√° interceptamos, n√£o fa√ßa nada.
    if (!isGloballyMuted || OriginalAudio.__isPatched) {
        return;
    }

    // Sobrescreve o construtor nativo
    window.Audio = function(src) {
        // 1. Cria o objeto de √°udio usando o construtor original
        const audioInstance = new OriginalAudio(src);

        // 2. Verifica se o 'src' corresponde a um BGM
        const isBGM = src && BGM_URL_FRAGMENTS.some(fragment => src.includes(fragment));

        if (isBGM) {
            // 3. Se for BGM e o mute estiver ativo, for√ßa o volume para 0.
            audioInstance.volume = 0;
            // console.log(`[MUTE PATCH] Muted BGM: ${src}`); // Opcional para debug

            // 4. Adiciona um 'setter' falso para a propriedade 'volume' do objeto
            // Isso previne que seus scripts de p√°gina (ex: combatMusic.volume = 0.4;)
            // consigam desmutar o √°udio posteriormente.
            Object.defineProperty(audioInstance, 'volume', {
                get() {
                    return 0; // Sempre retorna 0
                },
                set(newValue) {
                    // Se o valor for 0 (mutar) ou o valor antigo for 0, permite que o script original
                    // defina o volume, mas mantemos o nosso em 0.
                    // Isso √© para o caso de o usu√°rio querer restaurar o volume no futuro.
                    if (newValue > 0 && isGloballyMuted) {
                        // console.warn(`[MUTE PATCH] Tentativa de desmutar BGM bloqueada. Estado global: Mutado.`);
                    }
                    // O objeto de √°udio real continua mutado (volume = 0)
                },
                configurable: true // Permite que seja redefinido se o estado mudar
            });

        }

        // 5. Retorna a inst√¢ncia (mutada ou n√£o)
        return audioInstance;
    };
    
    // Marca o construtor como modificado
    window.Audio.__isPatched = true;
    
    // Opcional: Se o bot√£o de toggle for clicado para desmutar, precisamos restaurar a fun√ß√£o
    // O script do index.html (que tem o toggle) pode usar o window.applyGlobalMuteToMusic.

})();
</script>
<div id="leftSideMenu">
    <div class="menu-header">
        <button id="closeMenuBtn" class="close-menu-btn">
             </button>
        <h3>Menu</h3>
        <div style="width: 28px;"></div> 
    </div>
    <ul id="menuList" class="menu-list">
        </ul>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // URL base para as imagens
    const assetBase = "https://aden-rpg.pages.dev/assets/";

    // Defini√ß√£o dos itens com chaves de notifica√ß√£o
    const menuItems = [
        { name: "Tela inicial", url: "index.html", icon: assetBase + "homeic.webp" },
        { name: "Aventura AFK", url: "afk.html", icon: assetBase + "expm.webp", key: 'afk' },
        { name: "Minera√ß√£o", url: "mines.html", icon: assetBase + "recursos.webp" }, 
        { name: "Arena PvP", url: "arena.html", icon: assetBase + "pvp.webp", key: 'arena' },
        { name: "Chefe Mundial", url: "solo_boss.html", icon: assetBase + "bossm.webp", key: 'boss' },
        { name: "Guilda", url: "guilda.html", icon: assetBase + "guilda.webp", key: 'guild' },
        { name: "Bolsa", url: "inventory.html", icon: assetBase + "iconbolsa.webp" },
        { name: "Ranking", url: "ranking_cp.html", icon: assetBase + "iconranking.webp" },
        { name: "T√≠tulos", url: "titulos.html", icon: assetBase + "icontitulos.webp" },
        { name: "Resgate", url: "resgate.html", icon: assetBase + "resgate.webp" }
    ];

    const menuList = document.getElementById("menuList");
    const sideMenu = document.getElementById("leftSideMenu");
    const overlay = document.getElementById("sideMenuOverlay");
    const openBtn = document.getElementById("menuToggleBtn");
    const closeBtn = document.getElementById("closeMenuBtn");

    // SVG Padr√£o (Hamb√∫rguer)
    const hamburgerSVG = `
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    `;

    // Insere o SVG no bot√£o de fechar interno
    if(closeBtn) closeBtn.innerHTML = hamburgerSVG;

    // Identifica a p√°gina atual
    const currentPage = window.location.pathname.split("/").pop() || "index.html";

    // --- GERA O MENU ---
    if (menuList) {
        menuList.innerHTML = menuItems.map(item => {
            const isActive = currentPage.includes(item.url);
            return `
                <li class="menu-item ${isActive ? 'active' : ''}">
                    <a style="font-size: 1em;" class="menu-link" ${isActive ? '' : `href="${item.url}"`} data-menu-key="${item.key || ''}">
                        <img src="${item.icon}" class="menu-icon" alt="√≠cone" onerror="this.style.display='none'">
                        <span>${item.name}</span>
                    </a>
                </li>
            `;
        }).join('');
    }

    // --- FUN√á√ïES DE CONTROLE DO MENU ---

    const toggleMenuRotation = (isOpening) => {
        if (!openBtn) return;
        const svg = openBtn.querySelector('svg');
        if (svg) {
            if (isOpening) {
                svg.classList.add('icon-vertical'); // Gira 90 graus (Fica em p√©)
            } else {
                svg.classList.remove('icon-vertical'); // Volta ao normal
            }
        }
    };

    const openMenu = () => {
        sideMenu.classList.add("open");
        if(overlay) overlay.style.display = "block";
        
        // Anima o √≠cone do topo
        toggleMenuRotation(true);

        setTimeout(() => {
            if(overlay) {
                overlay.style.opacity = "1";
                overlay.style.pointerEvents = "auto";
            }
        }, 10);
    };

    const closeMenu = () => {
        sideMenu.classList.remove("open");
        if(overlay) {
            overlay.style.opacity = "0";
            overlay.style.pointerEvents = "none";
        }

        // Retorna a anima√ß√£o do √≠cone do topo
        toggleMenuRotation(false);

        setTimeout(() => {
            if(overlay) overlay.style.display = "none";
        }, 300);
    };

    if(openBtn) openBtn.addEventListener("click", openMenu);
    if(closeBtn) closeBtn.addEventListener("click", closeMenu);
    if(overlay) overlay.addEventListener("click", closeMenu);

    // --- RENDERIZAR NOTIFICA√á√ïES (BOLINHAS) ---
    const renderSideMenuNotifications = () => {
        const STORAGE_KEY_ACTIONS = 'aden_daily_actions_status';
        let dailyStatus = {};
        try {
            dailyStatus = JSON.parse(localStorage.getItem(STORAGE_KEY_ACTIONS) || '{}');
        } catch(e) {}

        // L√≥gica de Guilda (Fim de semana)
        let showGuildDot = false;
        const now = new Date();
        const day = now.getUTCDay(); 
        const hours = now.getUTCHours();
        const minutes = now.getUTCMinutes();
        const KEY_SAT = 'aden_guild_notif_seen_saturday';
        const KEY_SUN = 'aden_guild_notif_seen_sunday';

        if (day === 1) { 
             localStorage.removeItem(KEY_SAT); 
             localStorage.removeItem(KEY_SUN); 
        }
        if (day === 6 && !localStorage.getItem(KEY_SAT)) showGuildDot = true;
        if (day === 0 && (hours === 23 && minutes >= 30) && !localStorage.getItem(KEY_SUN)) showGuildDot = true;

        const links = menuList.querySelectorAll('.menu-link');
        links.forEach(link => {
            const key = link.getAttribute('data-menu-key');
            let shouldShow = false;

            if (key && dailyStatus[key] === true) shouldShow = true;
            if (key === 'guild' && showGuildDot) shouldShow = true;

            // Limpa bolinha antiga
            const existingDot = link.querySelector('.menu-notification-dot');
            if (existingDot) existingDot.remove();

            // Adiciona nova
            if (shouldShow) {
                const dot = document.createElement('div');
                dot.className = 'menu-notification-dot';
                link.appendChild(dot);
            }
        });
    };

    // Executa ao carregar
    renderSideMenuNotifications();
});
</script>
</body>

</html>