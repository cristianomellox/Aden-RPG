<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <title>Guilda - Aden RPG</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="maintenance.js"></script>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mines.css" />
    <link rel="stylesheet" href="guild.css" />

</head>
<body>

    <div id="playerTopBar">
        <a href="index.html?refresh=true" class="top-bar-link" title="Voltar">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg>
        </a>
       <div> <span id="pageTitle">Guilda</span></div>
        <a href="#" class="top-bar-link" id="refreshBtn" title="Recarregar">
            <img src="https://aden-rpg.pages.dev/assets/refresh.webp" alt="Recarregar" style="width:30px; height:30px;">
        </a>
    </div>

    <div id="mainContainer">
        <div id="tabMenu">
            <span class="tab-btn active" data-tab="guilda">Guilda</span>
            <span class="tab-btn" data-tab="sala">Sala</span>
            <span class="tab-btn" data-tab="ranking">Ranking</span>
            <span class="tab-btn" data-tab="raid">Raid</span>
            <span class="tab-btn" data-tab="batalhas">Batalhas</span>
        </div>

        <div id="tabContent">
            <div id="guilda" class="tab-pane active">
                <div id="guildInfoContainer" style="display:none;">
                   
              <div class="icon-container"><img id="editGuildBtn" src="https://aden-rpg.pages.dev/assets/config.webp" style="width:34px;height:34px;border-radius:4px; display: none;"></img></div>     
                    <div id="guildInfoHeader" style="display:flex; justify-content:center; align-items:center;">
                  
                        
                    </div>
                   <div id="guildName"></div>
<img alt="poder" id="cpIcon" style="width: 20px; height: 32px; margin-top: -4px;" src="https://aden-rpg.pages.dev/assets/CPicon.webp"/> <span id="guildPower" style="color:orange; font-weight:bold; font-size:1.8em; margin-top:4px;"></span>

                    <div id="guildDescription" style="margin:6px 0;color:white; font-size: 0.8em;"></div>
                    
                    <div id="guildLevel">
                        <span style="color: yellow; font-weight: bold; font-size: 0.9em;">Nv. <span id="guildLevelValue"></span></span>
              <div class="xp-bar-container">
    <div class="xp-bar-fill"></div>
    <div id="guildXpFill"></div>
</div>

                    </div>
                    <div class="member-list-container">
                        <h4>Membros (<span id="guildMemberCountHeader">0</span>)</h4>
                        <ul id="guildMemberList"></ul>
                    </div>
                    <br><br><br>
                    <div style="border-bottom: 5px solid grey; border-radius: 8px;"></div>
                    <div id="risco">
  <h3>Área de Risco</h3>
  <div>
    <div id="deleteguild">
     
      <span>Deletar <br>Guilda</span>
    </div>
    <div id="leaveguild">
     
      <span>Sair <br>da Guilda</span>
    </div>
  </div>
</div>
                   
                </div>
                <div id="noGuildContainer" style="display:none;">
                  <div id="criar">
                    <p>Você não faz parte de uma guilda.</p>
                    <button class="action-btn" id="searchGuildBtn" style="color: white;"><span style="font-size: 1em;">Buscar <br>Guilda</span></button>
                    <button class="action-btn" id="createGuildBtn"style="color: white;"><span style="font-size: 1em;">Criar <br>Guilda</span></button>
                </div>
            </div>
</div>
            <div id="sala" class="tab-pane">
                <p>Conteúdo da Sala será adicionado aqui.</p>
            </div>

            <div id="ranking" class="tab-pane">
              <center>  <h3>Ranking das Guildas</h3></center>
                <ul id="guildRankingList"></ul>
            </div>

            <div id="raid" class="tab-pane" style="background: none;">
              <center><h3>Raid de Guilda</h3></center>
              <div id="raid_1">
                <div id="raid_torre">
                  <h3 class="tdd_h3">Torre da Desolação</h3>
                  <span class="tdd_desc">De Segunda a Sexta.<br>Líder e Co-Líderes<br>podem iniciar a Raid.</span>
                <img id="tdd" src="https://aden-rpg.pages.dev/assets/tddbanner.webp" style="width: 90vw; height: 180px; background: none;">
      </div>      
<!-- Modal para iniciar Raid -->
<div id="raidModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3>Torre da Desolação</h3>
    <p>Duração: 1 hora</p>
    <button id="startRaidBtn" class="action-btn">Iniciar Raid</button>
    <button id="cancelRaidBtn" class="action-btn">Cancelar</button>
  </div>
</div>

<!-- Modal de combate da Raid -->
<div id="raidCombatModal" class="modal" style="display:none;">
  <div class="modal-content">
   <div id="raidHeader" style="position:relative; display:flex; justify-content:center; align-items:center; padding:8px 0;">
  <div id="raidFloorInfo" style="position:absolute; left:-2px; margin-top: -24px; text-align:center;text-shadow:
        1px 1px 2px black,
        -1px -1px 2px black,
        1px -1px 2px black,
        -1px 1px 2px black, 
        0 0 2px black,
        0 0 4px black;"></div>
  <div id="raidTimerInfo" style="font-weight:bold; font-size:1.1em;"></div>
</div>
<div id="raidBackBtn" style="position:absolute; right:6px; margin-top: -16px; text-align:center;text-shadow:
        1px 1px 2px black,
        -1px -1px 2px black,
        1px -1px 2px black,
        -1px 1px 2px black, 
        0 0 2px black,
        0 0 4px black; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center;"> <img src="https://aden-rpg.pages.dev/assets/sair.webp" style="width:22px; height: 28px;">
        <small style="font-size: 0.6em;">voltar</small>
        </div>

    <div id="raidMonsterArea">
      <img id="raidMonsterImage" src="https://aden-rpg.pages.dev/assets/monstromina1.webp" style="width:200px; height: 300px;">
      <div id="raidMonsterHpBar">
        <div id="raidMonsterHpFill"></div>
        <span id="raidMonsterHpText"></span>
      </div>
    </div>
   <center> <img id="raidAttackBtn" src="https://aden-rpg.pages.dev/assets/attackbtn.webp" style="width:70px;height:70px;cursor:pointer; margin-top: 15px;"></center>
    <p>
      Ataques: <span id="raidPlayerAttacks">0</span>
      <button id="raidBuyAttackBtn" class="btn btn-gold">+</button><br>
      <span id="raidAttackCooldown"></span>
    </p>
    <div id="raidDamageRankingContainer">
      <h4>Ranking de Dano</h4>
      <ul id="raidDamageRankingList"></ul>
    </div>
   
  </div>
</div>


<div id="lastRaidResultModal" class="modal" style="display:none;">
    <div class="modal-content">
        <h3>Resultado da Última Raid</h3>
        <p>Na sua última incursão na Torre da Desolação, sua guilda alcançou:</p>
        <h2 id="lastRaidFloorResult" style="color: yellow; font-size: 2em; margin: 10px 0;">Andar 0</h2>
        <button id="startNewRaidFromLastResultBtn" class="action-btn">Iniciar Nova Raid</button>
        <button id="closeLastResultBtn" class="action-btn">Fechar</button>
    </div>
</div>

<!-- Modal de Recompensa ao derrotar monstro -->
<div id="raidRewardModal" class="modal" style="display:none; z-index: 12500">
  <div class="modal-content">
    <h3>Recompensa de Andar</h3>
    <p>Você ganhou:</p>
    <p><strong id="rewardXpText" style="color:lime;">0 XP</strong></p>
    <p><strong id="rewardCrystalsText" style="color:cyan;">0 Cristais</strong></p>
    <button id="rewardOkBtn" class="action-btn">Ok</button>
  </div>
</div>


                </div>
            </div>

            <div id="batalhas" class="tab-pane">
                <p>Conteúdo de Batalhas será adicionado aqui.</p>
            </div>
        </div>
    </div>

    <div id="createGuildModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>Criar Nova Guilda</h3>
            <p>Custo: <strong class="crystals-cost">2000</strong> Cristais</p>
            <p>Nível Mínimo: <strong class="level-min">10</strong></p>
            <input type="text" id="newGuildNameInput" placeholder="Nome da Guilda" maxlength="12">
            <button id="confirmCreateGuildBtn" class="action-btn">Criar</button>
            <p id="createGuildMessage" class="message"></p>
        </div>
    </div>

    <div id="editGuildModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <span style="position: fixed; margin-top: 3.7rem; right: 3rem; font-weight: bold; color: gold; font-size: 1.2em;">>>></span>
            <h3>Editar Guilda</h3>

           <div id="editTabMenu" class="tab-scroll">
    <span class="edit-tab-btn" data-tab="tab-edit">Editar</span>
    <span class="edit-tab-btn" data-tab="tab-requests">Solicitações</span>
    <span class="edit-tab-btn" data-tab="tab-manage">Gerenciar</span>
    <span class="edit-tab-btn" data-tab="tab-notice">Quadro de Aviso</span>
    <span class="edit-tab-btn" data-tab="tab-chest">Baú</span>
</div>


            <div id="editTabContent">
                <div id="tab-edit" class="edit-tab-pane" style="display:none;">
                    <label>Nome da Guilda (1x a cada 30 dias):</label>
                    <input type="text" id="editGuildName" maxlength="25">
                    <p id="editNameInfo" class="message"></p>

                    <label>Descrição:</label>
                    <textarea id="editGuildDescription" style="height: 120px; width: 90%;" maxlength="100"></textarea>

                    <label>Bandeira (URL):</label>
                    <input type="text" id="editGuildFlagUrl" placeholder="https://...">

                    <button id="saveGuildChangesBtn" class="action-btn">Salvar Alterações</button>
                </div>

                <div id="tab-requests" class="edit-tab-pane" style="display:none;">
                    <h4>Solicitações Pendentes</h4>
                    <ul id="guildRequestsList"></ul>
                </div>

                <div id="tab-manage" class="edit-tab-pane" style="display:none;">
                    <h4>Gerenciar Membros</h4>
                    <ul id="manageMembersList"></ul>
                </div>

                <div id="tab-notice" class="edit-tab-pane" style="display:none;">
                    <h4>Aviso Atual</h4>
                    <div id="guildNotice" style="padding:8px;border:1px solid #ddd;border-radius:6px;background:#444;"></div>
                    <div id="noticeInfo" style="font-size:0.9em;color:white;margin-top:6px;"></div>
                    <div id="noticeEditor" style="margin-top:8px;display:none;">
                        <textarea id="editGuildNotice" placeholder="Escreva um aviso breve..." maxlength="150" style="height: 120px; width: 85%;"></textarea>
                        <button id="saveGuildNoticeBtn" class="action-btn">Atualizar Aviso</button>
                    </div>
                    <hr style="margin:10px 0;">
                    <h4>Registro de Atividades</h4>
                    <ul id="guildLogsList"></ul>
                </div>

                <div id="tab-chest" class="edit-tab-pane" style="display:none;">
                    <h4>Baú</h4>
                    <p>Em breve.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="searchGuildModal" class="modal" style="display:none;">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3>Buscar Guilda</h3>
        <input type="text" id="searchGuildInput" placeholder="Nome da guilda...">
        <button id="searchGuildConfirmBtn" class="action-btn">Buscar</button>
        <ul id="searchGuildResults"></ul>
      </div>
    </div>
    <div id="viewGuildModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close-btn" id="viewGuildCloseBtn">&times;</span>
        <div id="guildViewContainer">
            <div id="guildViewHeader" style="display:flex; justify-content:center; align-items:center;"></div>
            <div id="guildViewName" style="text-align: center; font-size: 1.4em;"></div>
            <div style="text-align: center;">
                <img alt="poder" id="cpIcon" style="width: 28px; height: 37px; vertical-align: -4px;" src="https://aden-rpg.pages.dev/assets/CPicon.webp"/>
                <span id="guildViewPower" style="color:orange; font-weight:bold; font-size:1.7em; margin-top:4px;"></span>
            </div>
            <div id="guildViewDescription" style="margin:6px 0;color:white; font-size: 0.8em; text-align: center;"></div>
            <div style="text-align: center;">
                <span style="color: yellow; font-weight: bold; font-size: 1.3em;">Nv. <span id="guildViewLevelValue"></span></span>
            </div>
            <div class="member-list-container">
                <h4>Membros (<span id="guildViewMemberCountHeader">0</span>)</h4>
                <ul id="guildViewMemberList"></ul>
            </div>
            <div id="guildViewActions" style="text-align: center; margin-top: 20px;">
              
            </div>
        </div>
    </div>
</div>


<!-- Modal: Player -->
<div id="playerModal" class="modal" style="display:none; width: 92%;">
  <div class="modal-content">
    <span id="closePlayerModal" class="close-btn">&times;</span>

    <h3 id="playerName">Jogador</h3>
    <div id="playerLevel">Nv. 0</div>

    <div id="equipmentAndAvatarContainer">
      <div class="equipment-column">
        <div id="weapon-slot" class="equipment-slot" data-slot="weapon"></div>
        <div id="ring-slot" class="equipment-slot" data-slot="ring"></div>
        <div id="helm-slot" class="equipment-slot" data-slot="helm"></div>
        <div id="special1-slot" class="equipment-slot" data-slot="special1"></div>
      </div>

      <div id="playerAvatarEquipContainer">
        <div class="guild-header">
          <div style="display: flex;
  flex-direction: column; justify-content: center; text-align: center; align-items: center;">
          <img id="playerGuildFlag" src="https://aden-rpg.pages.dev/assets/guildaflag.webp" alt="Bandeira" onerror="this.style.display='none'">
          <div id="playerGuildName">Nome da Guilda</div>
        </div>
</div>
        <img id="playerAvatarEquip" src="https://via.placeholder.com/100" alt="Avatar do Jogador">
        <div style="display: flex; flex-wrap: nowrap; width: 100%; gap: 12px; justify-content: center; text-align: center; align-items: center;">
        <img alt="poder" id="cpIcon" style="width: 18px; height: 30px; vertical-align: 4px; position: relative; margin-top: 3px;" src="https://aden-rpg.pages.dev/assets/CPicon.webp"/><div id="playerCombatPower">0 </div>
      </div>
</div>
      <div class="equipment-column">
        <div id="amulet-slot" class="equipment-slot" data-slot="amulet"></div>
        <div id="wing-slot" class="equipment-slot" data-slot="wing"></div>
        <div id="armor-slot" class="equipment-slot" data-slot="armor"></div>
        <div id="special2-slot" class="equipment-slot" data-slot="special2"></div>
      </div>
    </div>

    <div id="attributesSection">
      <div class="attribute-row">
        <div class="attribute-item">
          <span class="attribute-label">ATK</span>
          <span id="playerAttack" class="attribute-value">0 - 0</span>
        </div>
        <div class="attribute-item">
          <span class="attribute-label">TAXA CRIT</span>
          <span id="playerCritChance" class="attribute-value">0%</span>
        </div>
        <div class="attribute-item">
          <span class="attribute-label">DANO CRIT</span>
          <span id="playerCritDamage" class="attribute-value">0%</span>
        </div>
      </div>

      <div class="attribute-row">
        <div class="attribute-item">
          <span class="attribute-label">HP</span>
          <span id="playerHealth" class="attribute-value">0</span>
        </div>
        <div class="attribute-item">
          <span class="attribute-label">DEFESA</span>
          <span id="playerDefense" class="attribute-value">0</span>
        </div>
        <div class="attribute-item">
          <span class="attribute-label">EVASÃO</span>
          <span id="playerEvasion" class="attribute-value">0%</span>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- FIM Modal: Player -->



<div id="loading-overlay" style="background-image: url('https://aden-rpg.pages.dev/assets/guildhall.webp');
    background-repeat: no-repeat;
    background-position: center center;
    background-size: cover;">
  <div id="loading-container">
    <h2>Carregando...</h2>
    <div id="progress-bar-container">
      <div id="progress-bar"></div>
    </div>
    <span id="progress-text">0%</span>
  </div>
</div>


<div id="maintenance-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); color: white; z-index: 9999; justify-content: center; align-items: center; text-align: center; flex-direction: column; font-family: Arial, sans-serif;">
    <img src="https://aden-rpg.pages.dev/assets/config.webp" alt="Manutenção" style="width: 120px; height: 120px; margin-bottom: 20px;">
    <h1 id="maintenance-title">Aviso de Manutenção</h1>
    <p id="maintenance-message" style="font-size: 1.1em; max-width: 80%;"></p>
    <p style="font-size: 0.9em; margin-top: 20px;">Obrigado pela sua paciência.</p>
</div>
<div id="countdown-banner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; padding: 10px; background-color: rgba(0, 0, 0, 0.9); color: white; text-align: center; z-index: 9999; font-family: Arial, sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.3); font-weight: bold;">
    <div style="font-size: 1.5em; font-weight: bold;">
        <span id="countdown-timer"></span>
    </div>
    <div style="font-size: 0.9em; margin-top: 5px;">
        O servidor entrará em manutenção dentro de instantes. Por favor, não inicie alguma operação no jogo para não ter risco de perda de dados. Obrigado pela paciência!
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // cria um elemento para medir o tamanho real de 1rem
  const testEl = document.createElement("div");
  testEl.style.cssText = "position:absolute;visibility:hidden;font-size:1rem;line-height:1;";
  testEl.textContent = "M";
  document.body.appendChild(testEl);

  const actualRem = testEl.getBoundingClientRect().height;
  document.body.removeChild(testEl);

  console.log("[scale-lock] 1rem real:", actualRem, "px");

  // queremos sempre 16px como base (modo padrão)
  const targetRem = 16;
  const correction = targetRem / actualRem;

  const style = document.createElement("style");
  style.textContent = `
    html { font-size: ${16 * correction}px !important; }
    body { font-size: 1.5rem !important; }
  `;
  document.head.appendChild(style);

  console.log("[scale-lock] Correção aplicada, fator:", correction.toFixed(2));
});
</script>




<script src="loading.js"></script>
   <script src="number_format.js"></script>
    <script src="guild.js"></script>
    <script src="playerModal.js"></script>
    <script src="guild_raid.js"></script>

</body>
</html>
