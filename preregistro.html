<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pr√©-Registro - Aden RPG</title>
<link rel="stylesheet" href="style.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div id="authContainer" style="display:flex;">

    <div id="authSideButtons">
        <a href="suporte.html" class="auth-side-btn">
            <img src="https://aden-rpg.pages.dev/assets/suporte.webp" style="width:40px;height:40px">
            <span>Suporte</span>
        </a>
        <a href="sobre.html" class="auth-side-btn">
            <img src="https://aden-rpg.pages.dev/assets/sobre.webp" style="width:40px;height:40px">
            <span>Sobre</span>
        </a>
    </div>

    <div id="topCountdown"
         style="text-align:center; margin-bottom:25px; background:rgba(0,0,0,0.35);
                padding:12px; border-radius:8px; width:90vw; max-width:420px;">
        <h3 class="preh1" style="margin:0;">Lan√ßamento Oficial:</h3>
        <h1 id="countdownTop" style="font-size:1.8em;margin:5px 0 0 0;">00 00:00:00</h1>
    </div>

    <div id="caixaLogin">
        <h2>Pr√©-Registro</h2>

        <!-- EMAIL -->
        <input id="emailInput" type="email" placeholder="Seu e-mail" />

        <!-- SENHA (IGUAL AO index.html) -->
        <input id="passwordInput" type="password" placeholder="Sua senha" />

        <!-- OTP -->
        <div id="otpInputContainer" style="display:none;">
            <input id="otpInput" type="text" placeholder="C√≥digo de confirma√ß√£o" />
            <button id="verifyOtpBtn">Confirmar C√≥digo</button>
        </div>

        <div id="btnReg">
            <button id="signUpBtn">Registrar</button>
        </div>

        <p id="authMessage"></p>

        <p style="background-color:rgba(51,51,51,0.8); text-align:center; border-radius:5px;
                  width:85vw; font-size:0.9em; padding:5px 0; margin-top:10px; color:#ccc;">
            &copy; 2025 - 2026 Aden RPG Online. Todos os direitos reservados.
        </p>
    </div>
</div>

<script>
/* ============================================================
   üéµ L√ìGICA DA M√öSICA (MESMA DO script.js)
   ============================================================ */
let musicStarted = false;
let backgroundMusic = null;

function startBackgroundMusic(forceMute = false) {
    if (!backgroundMusic) {
        backgroundMusic = new Audio("https://aden-rpg.pages.dev/assets/aden.mp3");
        backgroundMusic.volume = 0.2;
        backgroundMusic.loop = true;
    }

    if (musicStarted && !forceMute && backgroundMusic.muted) {
        backgroundMusic.muted = false;
        return;
    }

    if (musicStarted && !forceMute) return;

    backgroundMusic.muted = forceMute;

    const playPromise = backgroundMusic.play();
    if (playPromise !== undefined) {
        playPromise.then(() => {
            musicStarted = true;
        }).catch(() => {
            backgroundMusic.muted = true;
            backgroundMusic.play().then(() => {
                musicStarted = true;
                function onFirstGesture() {
                    backgroundMusic.muted = false;
                    window.removeEventListener("pointerdown", onFirstGesture);
                }
                window.addEventListener("pointerdown", onFirstGesture, { once:true });
            });
        });
    }
}

document.addEventListener("DOMContentLoaded", () => {
    const events = ["click","pointerdown","touchstart","mousedown","keydown"];
    for (const ev of events) {
        window.addEventListener(ev, () => startBackgroundMusic());
        document.body.addEventListener(ev, () => startBackgroundMusic());
    }
});

/* ============================================================
   ‚è≥ CONTADOR (24/01)
   ============================================================ */
const releaseDate = new Date("2025-11-22T10:00:00");
function formatTime(n){ return n < 10 ? "0"+n : n; }
function startCountdown(){
    const topEl = document.getElementById("countdownTop");

    setInterval(()=>{
        const now = new Date();
        const diff = releaseDate - now;

        if (diff <= 0) {
            topEl.innerText = "J√° dispon√≠vel!";
            return;
        }

        const d = Math.floor(diff/(1000*60*60*24));
        const h = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
        const m = Math.floor((diff%(1000*60*60))/(1000*60));
        const s = Math.floor((diff%(1000*60))/1000);

        topEl.innerText = `${d}D ${formatTime(h)}:${formatTime(m)}:${formatTime(s)}`;
    },1000);
}
startCountdown();

/* ============================================================
   üìß PR√â-REGISTRO COM SENHA (IGUAL AO index.html)
   ============================================================ */

const SUPABASE_URL = "https://lqzlblvmkuwedcofmgfb.supabase.co";
const SUPABASE_KEY = "sb_publishable_le96thktqRYsYPeK4laasQ_xDmMAgPx";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

document.getElementById("signUpBtn").addEventListener("click", async () =>{
    const email = document.getElementById("emailInput").value.trim();
    const password = document.getElementById("passwordInput").value.trim();
    const msg = document.getElementById("authMessage");

    if (!email) return msg.innerText = "Digite seu e-mail";
    if (!password) return msg.innerText = "Digite uma senha";

    msg.innerText = "Enviando c√≥digo...";

    const { error } = await supabaseClient.auth.signUp({
        email,
        password,
        options: { emailRedirectTo: window.location.origin }
    });

    if (error) {
        msg.innerText = error.message;
        return;
    }

    msg.innerText = "C√≥digo enviado ao seu e-mail!";
    document.getElementById("otpInputContainer").style.display = "block";
});

document.getElementById("verifyOtpBtn").addEventListener("click", async ()=>{
    const email = document.getElementById("emailInput").value.trim();
    const token = document.getElementById("otpInput").value.trim();
    const msg = document.getElementById("authMessage");

    const { error } = await supabaseClient.auth.verifyOtp({
        email,
        token,
        type: "signup"
    });

    if (error) {
        msg.innerText = error.message;
        return;
    }

    /* ============================================================
       üÜï NOVO COMPORTAMENTO AP√ìS CONFIRMAR O C√ìDIGO
       ============================================================ */
    const caixa = document.getElementById("caixaLogin");

    caixa.innerHTML = `
        <h2 style="text-align:center;">Pr√©-Registro Conclu√≠do!</h2>
        <p style="
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 10px;
            color: #ddd;
            font-size: 1.1em;
        ">
            Seu pr√©-registro foi realizado com sucesso.<br><br>
            Assim que o lan√ßamento acontecer, voc√™ poder√° fazer o login com o e-mail e senha que voc√™ cadastrou.
        </p>
    `;
});
</script>

</body>
</html>
